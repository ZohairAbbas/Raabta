<!DOCTYPE html>
<html dir="ltr" lang="en">

<%- include("./partials/Dashboard_head.ejs") %>


  <body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
      <div class="lds-ripple">
        <div class="lds-pos"></div>
        <div class="lds-pos"></div>
      </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
      data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
      <!-- ============================================================== -->
      <!-- Topbar header - style you can find in pages.scss -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- End Topbar header -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- Left Sidebar - style you can find in sidebar.scss  -->
      <!-- ============================================================== -->
      <aside class="left-sidebar" data-sidebarbg="skin6">
        <!-- Sidebar scroll-->
        <div class="scroll-sidebar">
          <!-- Sidebar navigation-->
          <nav class="sidebar-nav">
            <ul id="sidebarnav">
              <!-- User Profile-->
              <li>
                <!-- User Profile-->
                <div class="user-profile d-flex no-block dropdown m-t-20">
                  <div class="user-pic">
                    <img src="images/users/1.jpg" alt="users" class="rounded-circle" width="40" />
                  </div>
                  <div class="user-content hide-menu m-l-10">
                    <a href="#" class="" id="Userdd" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
                      aria-expanded="false">
                      <h5 class="m-b-0 user-name font-medium">
                        <span id="name">Steave Jobs</span> <i class="fa fa-angle-down"></i>
                      </h5>
                      <span id="email" class="op-5 user-email">varun@gmail.com</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="Userdd">
                      <a class="dropdown-item" href="/pages-profile"><i class="ti-user m-r-5 m-l-5"></i> My Profile</a>
                      <a id="logOut" class="dropdown-item" href="javascript:void(0)"><i
                          class="fa fa-power-off m-r-5 m-l-5"></i>
                        Logout</a>
                    </div>
                  </div>
                </div>
                <!-- End User Profile-->
              </li>
              <li class="p-15 m-t-10">
                <a href="/user-dashboard" class="
                        btn
                        d-block
                        w-100
                        create-btn
                        text-white
                        no-block
                        d-flex
                        align-items-center
                      "><i class="fa fa-plus-square"></i>
                  <span class="hide-menu m-l-5">Appointments</span>
                </a>
              </li>
              <!-- User Profile-->
              <!-- <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="index.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-view-dashboard"></i
                      ><span class="hide-menu">Dashboard</span></a
                    >
                  </li>
                  <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="pages-profile.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-account-network"></i
                      ><span class="hide-menu">Profile</span></a
                    >
                  </li>
                  <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="table-basic.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-border-all"></i
                      ><span class="hide-menu">Table</span></a
                    >
                  </li>
                  <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="icon-material.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-face"></i
                      ><span class="hide-menu">Icon</span></a
                    >
                  </li>
                  <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="starter-kit.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-file"></i
                      ><span class="hide-menu">Blank</span></a
                    >
                  </li>
                  <li class="sidebar-item">
                    <a
                      class="sidebar-link waves-effect waves-dark sidebar-link"
                      href="error-404.html"
                      aria-expanded="false"
                      ><i class="mdi mdi-alert-outline"></i
                      ><span class="hide-menu">404</span></a
                    >
                  </li> -->

            </ul>
          </nav>
          <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
      </aside>
      <!-- ============================================================== -->
      <!-- End Left Sidebar - style you can find in sidebar.scss  -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- Page wrapper  -->
      <!-- ============================================================== -->
      <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <div class="page-breadcrumb">
          <div class="row align-items-center">
            <div class="col-5">
              <h4 class="page-title">Profile Page</h4>
              <div class="d-flex align-items-center">
              </div>
            </div>

          </div>
        </div>
        <!-- ============================================================== -->
        <!-- End Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid">
          <!-- ============================================================== -->
          <!-- Start Page Content -->
          <!-- ============================================================== -->
          <!-- Row -->
          <div class="row">
            <!-- Column -->
            <div class="col-lg-4 col-xlg-3 col-md-5">
              <div class="card">
                <div class="card-body">
                  <center class="m-t-30"> <img src="images/users/5.jpg" class="rounded-circle" width="150" />
                    <h3 id="name-avatar" class="card-title m-t-10">Hanna Gover</h3>
                  </center>
                </div>
                <div>
                  <hr>
                </div>
                <div class="card-body"> <small class="text-muted">Email address </small>
                  <h6 id="email-avatar">hannagover@gmail.com</h6> <small class="text-muted p-t-30 db">Bio</small>
                  <h6 id="bio-avatar">Display user bio here</h6>

                  <br />
                </div>
              </div>
            </div>
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-8 col-xlg-9 col-md-7">
              <div class="card">
                <div class="card-body">
                  <form method="post" id="editProfile" class="form-horizontal form-material mx-2">
                    <div class="form-group">
                      <label class="col-md-12">First Name</label>
                      <div class="col-md-12">
                        <input id="first-name" type="text" placeholder="Johnathan"
                          class="form-control form-control-line">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-md-12">Last Name</label>
                      <div class="col-md-12">
                        <input id="last-name" type="text" placeholder="Doe" class="form-control form-control-line">
                      </div>
                    </div>
                    <!-- <div class="form-group">
                      <label for="example-email" class="col-md-12">Email</label>
                      <div class="col-md-12">
                        <input type="email" placeholder="johnathan@admin.com" class="form-control form-control-line"
                          name="example-email" id="example-email">
                      </div>
                    </div> -->
                    <div class="form-group">
                      <label class="col-md-12">Password</label>
                      <div class="col-md-12">
                        <input id="password" type="password" value="password" class="form-control form-control-line">
                      </div>
                    </div>
                    <!-- <div class="form-group">
                      <label class="col-md-12">Phone No</label>
                      <div class="col-md-12">
                        <input type="text" placeholder="123 456 7890" class="form-control form-control-line">
                      </div>
                    </div> -->
                    <div class="form-group">
                      <label class="col-md-12">Bio</label>
                      <div class="col-md-12">
                        <textarea id="bio" rows="5" class="form-control form-control-line"></textarea>
                      </div>
                    </div>

                    <div class="form-group">
                      <div class="col-sm-12">
                        <button type="submit" class="btn btn-success text-white">Update Profile</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <!-- Column -->
          </div>
          <!-- Row -->
          <!-- ============================================================== -->
          <!-- End PAge Content -->
          <!-- ============================================================== -->
          <!-- ============================================================== -->
          <!-- Right sidebar -->
          <!-- ============================================================== -->
          <!-- .right-sidebar -->
          <!-- ============================================================== -->
          <!-- End Right sidebar -->
          <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Container fluid  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- footer -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- End footer -->
        <!-- ============================================================== -->
      </div>
      <!-- ============================================================== -->
      <!-- End Page wrapper  -->
      <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->

    <%- include("./partials/Dashboard_scripts.ejs") %>
      <script>
        // session maintain
        let token = JSON.parse(localStorage.getItem('token'))
        console.log("token in user-dashboard", !token, token)
        if (!token) {
          window.location.replace('/login')
        }

        // fetch user details from localStrorage
        let user = JSON.parse(localStorage.getItem('user'))
        console.log("user in pages-profile", user)
        document.getElementById('name').innerHTML = user.FirstName + " " + user.LastName;
        document.getElementById('email').innerHTML = user.FirstName + " " + user.LastName;
        document.getElementById('name-avatar').innerHTML = user.FirstName + " " + user.LastName;
        document.getElementById('email-avatar').innerHTML = user.Email
        document.getElementById('bio-avatar').innerHTML = user.Bio

        // edit profile form submission
        const form = document.getElementById("editProfile");
        form.addEventListener("submit", submitEditProfile);

        async function submitEditProfile(event) {
          event.preventDefault();
          let user = JSON.parse(localStorage.getItem('user'))
          console.log("user in submitEditProfile", user, "and user_id", user._id)
          const FirstName = document.getElementById("first-name").value;
          const LastName = document.getElementById("last-name").value;
          const Password = document.getElementById("password").value;
          const Bio = document.getElementById("bio").value;
          const Email = user.Email;
          const id = user._id.toString()
          console.log("editProfile form values", FirstName, LastName, Password, Bio, Email, id)

          const result = await fetch(`/api/updateProfile/${user._id}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              user: {
                FirstName,
                LastName,
                Email,
                Password,
                Bio
              }
            }),
          }).then((response) => response.json())
            .then(result => {
              console.log("data on submitEditProfile", result.user)

              if (result.status === "ok") {
                localStorage.setItem('user', JSON.stringify(result.user));
                alert("Profile Updated");
                if (result.user.Role == "Client") {
                  window.location.href = '/expert-dashboard'
                } else {
                  window.location.href = '/user-dashboard'
                }
              } else {
                alert(result.error);
              }
            })
        }


        //logout
        var logOutUser = () => {
          localStorage.removeItem("token")
          localStorage.removeItem("user")
          window.location.replace("/login")
        }

        const logOut = document.getElementById("logOut");
        logOut.addEventListener("click", logOutUser);

      </script>
  </body>

</html>