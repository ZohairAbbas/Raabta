<!DOCTYPE html>
<html dir="ltr" lang="en">

<%- include("./partials/Dashboard_head.ejs") %>

  <style>
    .acceptButton {
      background-color: #004A7F;
      -webkit-border-radius: 10px;
      border-radius: 3px;
      border: none;
      color: #FFFFFF;
      cursor: pointer;
      display: inline-block;
      font-family: Arial;
      font-size: 1.2rem;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
    }

    .acceptButton:hover {
      background-color: #4f92fc;
    }

    .rejectButton {
      background-color: #CC0001;
      -webkit-border-radius: 10px;
      border-radius: 3px;
      border: none;
      color: #FFFFFF;
      cursor: pointer;
      display: inline-block;
      font-family: Arial;
      font-size: 1.2rem;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
    }

    .rejectButton:hover {
      background-color: #FF3548;
    }
  </style>

  <body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
      <div class="lds-ripple">
        <div class="lds-pos"></div>
        <div class="lds-pos"></div>
      </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
      data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
      <!-- ============================================================== -->
      <!-- Topbar header - style you can find in pages.scss -->
      <!-- ============================================================== -->
      <!-- <header class="topbar" data-navbarbg="skin5"> -->
      <!-- <nav class="navbar top-navbar navbar-expand-md navbar-dark"> -->
      <!-- <div class="navbar-header" data-logobg="skin5">  
       
            <a class="navbar-brand" href="index.html">
              
              <b class="logo-icon">
                
                <img
                  src="../../assets/images/logo-icon.png"
                  alt="homepage"
                  class="dark-logo"
                />
               
                <img
                  src="../../assets/images/logo-light-icon.png"
                  alt="homepage"
                  class="light-logo"
                />
              </b>
              
              <span class="logo-text">
                
                <img
                  src="../../assets/images/logo-text.png"
                  alt="homepage"
                  class="dark-logo"
                />
                
                <img
                  src="../../assets/images/logo-light-text.png"
                  class="light-logo"
                  alt="homepage"
                />
              </span>
            </a>
           
            <a
              class="nav-toggler waves-effect waves-light d-block d-md-none"
              href="javascript:void(0)"
              ><i class="ti-menu ti-close"></i
            ></a>
          </div>
        -->
      <!-- <div
            class="navbar-collapse collapse"
            id="navbarSupportedContent"
            data-navbarbg="skin5"
          > 
            
            <ul class="navbar-nav float-start me-auto">
              
            </ul>
            
            <ul class="navbar-nav float-end">
           
              <li class="nav-item dropdown">
                <a
                  class="
                    nav-link
                    dropdown-toggle
                    text-muted
                    waves-effect waves-dark
                    pro-pic
                  "
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <img
                    src="../../assets/images/users/1.jpg"
                    alt="user"
                    class="rounded-circle"
                    width="31"
                  />
                </a>
                <ul
                  class="dropdown-menu dropdown-menu-end user-dd animated"
                  aria-labelledby="navbarDropdown"
                >
                  <a class="dropdown-item" href="javascript:void(0)"
                    ><i class="ti-user m-r-5 m-l-5"></i> My Profile</a
                  >
                  <a class="dropdown-item" href="javascript:void(0)"
                    ><i class="ti-wallet m-r-5 m-l-5"></i> My Balance</a
                  >
                  <a class="dropdown-item" href="javascript:void(0)"
                    ><i class="ti-email m-r-5 m-l-5"></i> Inbox</a
                  >
                </ul>
              </li>
            
            </ul>
          </div> -->
      </nav>
      </header>
      <!-- ============================================================== -->
      <!-- End Topbar header -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- Left Sidebar - style you can find in sidebar.scss  -->
      <!-- ============================================================== -->
      <aside class="left-sidebar" data-sidebarbg="skin6">
        <!-- Sidebar scroll-->
        <div class="scroll-sidebar">
          <!-- Sidebar navigation-->
          <nav class="sidebar-nav">
            <ul id="sidebarnav">
              <!-- User Profile-->
              <li>
                <!-- User Profile-->
                <div class="user-profile d-flex no-block dropdown m-t-20">
                  <div class="user-pic">
                    <img src="images/users/1.jpg" alt="users" class="rounded-circle" width="40" />
                  </div>
                  <div class="user-content hide-menu m-l-10">
                    <a href="#" class="" id="Userdd" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
                      aria-expanded="false">
                      <h5 class="m-b-0 user-name font-medium">
                        <span id="name">Steave Jobs</span><i class="fa fa-angle-down"></i>
                      </h5>
                      <span id="email" class="op-5 user-email">varun@gmail.com</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="Userdd">
                      <a class="dropdown-item" href="/pages-profile"><i class="ti-user m-r-5 m-l-5"></i> My Profile</a>
                      <a id="logOut" class="dropdown-item" href="javascript:void(0)"><i
                          class="fa fa-power-off m-r-5 m-l-5"></i>
                        Logout</a>
                    </div>
                  </div>
                </div>
                <!-- End User Profile-->
              </li>
              <li class="p-15 m-t-10">
                <a href="/expert-dashboard" class="
                    btn
                    d-block
                    w-100
                    create-btn
                    text-white
                    no-block
                    d-flex
                    align-items-center
                  "><i class="fa fa-plus-square"></i>
                  <span class="hide-menu m-l-5">Appointments</span>
                </a>
              </li>
              <!-- User Profile-->
              <!-- <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="index.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-view-dashboard"></i
                  ><span class="hide-menu">Dashboard</span></a
                >
              </li>
              <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="pages-profile.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-account-network"></i
                  ><span class="hide-menu">Profile</span></a
                >
              </li>
              <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="table-basic.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-border-all"></i
                  ><span class="hide-menu">Table</span></a
                >
              </li>
              <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="icon-material.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-face"></i
                  ><span class="hide-menu">Icon</span></a
                >
              </li>
              <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="starter-kit.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-file"></i
                  ><span class="hide-menu">Blank</span></a
                >
              </li>
              <li class="sidebar-item">
                <a
                  class="sidebar-link waves-effect waves-dark sidebar-link"
                  href="error-404.html"
                  aria-expanded="false"
                  ><i class="mdi mdi-alert-outline"></i
                  ><span class="hide-menu">404</span></a
                >
              </li> -->

            </ul>
          </nav>
          <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
      </aside>
      <!-- ============================================================== -->
      <!-- End Left Sidebar - style you can find in sidebar.scss  -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- Page wrapper  -->
      <!-- ============================================================== -->
      <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <div class="page-breadcrumb">
          <div class="row align-items-center">
            <div class="col-5">
              <h4 class="page-title">Expert Dashboard --> All Appointments</h4>
              <div class="d-flex align-items-center">
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">
                      Library
                    </li> -->
                  </ol>
                </nav>
              </div>
            </div>
            <div class="col-7">

            </div>
          </div>
        </div>
        <!-- ============================================================== -->
        <!-- End Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid">

          <!-- ============================================================== -->
          <!-- Sales chart -->
          <!-- ============================================================== -->
          <!-- ============================================================== -->
          <!-- Table -->
          <!-- ============================================================== -->
          <div class="row">

            <div class="col-12">
              <div class="card">
                <div class="table-responsive">
                  <table class="table v-middle">
                    <thead>
                      <tr class="bg-light">
                        <th class="border-top-0">Client Name</th>
                        <th class="border-top-0">Date</th>
                        <th class="border-top-0">Time</th>
                        <th class="border-top-0">Confirm</th>
                        <th class="border-top-0">Decline</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            <div class="m-r-10">
                              <a class="
                                  btn btn-circle
                                  d-flex
                                  btn-info
                                  text-white
                                ">EA</a>
                            </div>
                            <div class="">
                              <h4 class="m-b-0 font-16">Elite Admin</h4>
                            </div>
                          </div>
                        </td>
                        <td>Single Use</td>
                        <td>John Doe</td>
                        <td><button type="submit" class="acceptButton">Accept</button></td>
                        <td><button type="submit" class="rejectButton">Reject</button></td>
                      </tr> -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- ============================================================== -->
          <!-- Recent comment and chats -->
          <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Container fluid  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- footer -->
        <!-- ============================================================== -->
        <!-- <footer class="footer text-center">
          All Rights Reserved by Xtreme Admin. Designed and Developed by
          <a href="https://www.wrappixel.com">WrapPixel</a>.
        </footer> -->
        <!-- ============================================================== -->
        <!-- End footer -->
        <!-- ============================================================== -->
      </div>
      <!-- ============================================================== -->
      <!-- End Page wrapper  -->
      <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->

    <%- include("./partials/Dashboard_scripts.ejs") %>

      <script>
        let token = JSON.parse(localStorage.getItem('token'))
        let user = JSON.parse(localStorage.getItem('user'))

        console.log("token in user-dashboard", !token, token)
        if (!token) {
          window.location.replace('/login')
        }
        console.log("user in expert-dashboard", user)
        document.getElementById('name').innerHTML = user.FirstName + " " + user.LastName;
        document.getElementById('email').innerHTML = user.Email

        //logout
        const logOutUser = () => {
          console.log("userClickedLogOut")
          localStorage.removeItem("token")
          localStorage.removeItem("user")
          window.location.replace("/login")
        }

        const logOut = document.getElementById("logOut");
        logOut.addEventListener("click", logOutUser);

        const fetchClientAppointments = async () => {
          const appoinments = await fetch(`/api/getExpertAppointments/${user._id}`).then((res) => {
            console.log("res ", res)
            return res.json()
          }).then(data => {
            console.log("data", data)
            return data
          });
          console.log("res on getExpertAppointments", appoinments)
          appoinments.map((appoinment, i) => {
            console.log("appointment", i, appoinment)
            var row = document.getElementsByTagName("tbody")[0];
            // var x = row.insertCell(-1);
            row.innerHTML = `${row.innerHTML}<tr>
                        <td>
                          <div class="d-flex align-items-center">
                            <div class="m-r-10">
                              <a class="
                                  btn btn-circle
                                  d-flex
                                  btn-info
                                  text-white
                                ">${appoinment.Client.FirstName[0]}${appoinment.Client.LastName[0]}</a>
                            </div>
                            <div class="">
                              <h4 class="m-b-0 font-16">${appoinment.Client.FirstName} ${appoinment.Client.LastName}</h4>
                            </div>
                          </div>
                        </td>
                        <td>${appoinment.Date}</td>
                        <td>${appoinment.Time}</td>
                        ${appoinment.Status == 'Pending' ? `<td><button id="accept-${i}" type="submit" class="acceptButton">Accept</button></td>
                        <td><button id="reject-${i}" type="submit" class="rejectButton">Reject</button></td>` : "<td><h4>Confirmed</h4></td>"}
                        
                      </tr>`;

          })
          appoinments.map((appointment, i) => {
            let btnAccepted = document.getElementById(`accept-${i}`);
            let btnRejected = document.getElementById(`reject-${i}`);
            // console.log("btnAccepted", btnAccepted)
            btnAccepted.addEventListener("click", (event) => {
              event.preventDefault()
              // console.log("accept i", i)
              AcceptAppointment(appointment)
            });
            btnRejected.addEventListener("click", (event) => {
              event.preventDefault()
              // console.log("reject i", i)
              RejectAppointment(appointment)
            });
          })
          const AcceptAppointment = async (appoinment) => {
            console.log("accepting appointment", appoinment)
            const result = await fetch(`/api/updateAppointment/${appoinment._id}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                Status: "Accepted"
              }),
            }).then((response) => response.json())
              .then(result => {
                console.log("data on submitEditAppointment", result.updatedAppointment)

                if (result.status === "ok") {
                  window.location.reload()
                } else {
                  alert(result.error);
                }
              })

          }
          const RejectAppointment = async (appoinment) => {
            console.log("accepting appointment", appoinment)
            const result = await fetch(`/api/deleteAppointment/${appoinment._id}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                Status: "Rejected"
              }),
            }).then((response) => response.json())
              .then(result => {
                console.log("data on submitEditAppointment", result.updatedAppointment)

                if (result.status === "ok") {
                  window.location.reload()
                } else {
                  alert(result.error);
                }
              })

          }
        }
        fetchClientAppointments()
      </script>
  </body>

</html>